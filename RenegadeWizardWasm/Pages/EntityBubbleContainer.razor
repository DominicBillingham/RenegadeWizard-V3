@using RenegadeWizardWasm.Core.UserInterface
@using RenegadeWizardWasm.Core.Enums

<div class="entity-bubble-container">
    
    <div class="bubble-list">

        @foreach (var creature in CreatureCards)
        {
            <div class="entity-bubble-wrapper">

                <div class="entity-bubble creature-bubble">
                    
                    @($"{creature.Name} ({creature.Hitpoints}hp) ")

                    @GetIntentIcon(creature.Intent)

                </div>

                <div class="entity-card-popup">
                    <div class="entity-card">
                        <div class="entity-header">
                            <div class="entity-name">@creature.Name</div>
                            <div class="header-right">
                                
                                @if (creature.Intent != null)
                                {
                                    <span class="entity-name">@creature.Intent.ToString()</span>
                                    @GetIntentIcon(creature.Intent)
                                }

                            </div>
                        </div>

                        @if (creature.Tags != null && creature.Tags.Any())
                        {
                            <div class="entity-tags">
                                @foreach (var tag in creature.Tags)
                                {
                                    <span class="tag-item">@tag</span>
                                }
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(creature.Description))
                        {
                            <div class="entity-description">
                                @creature.Description
                            </div>
                        }
                    </div>
                </div>
            </div>
        }

        @foreach (var item in ObjectCards)
        {
            <div class="entity-bubble-wrapper">
                <div class="entity-bubble item-bubble">
                    @item.Name
                </div>
                <div class="entity-card-popup">
                    <div class="entity-card">
                        <div class="entity-header">
                            <div class="entity-name">@item.Name</div>
                            @if (item.Hitpoints.HasValue)
                            {
                                <span class="entity-hp">@item.Hitpoints HP</span>
                            }
                        </div>

                        @if (item.Tags != null && item.Tags.Any())
                        {
                            <div class="entity-tags">
                                @foreach (var tag in item.Tags)
                                {
                                    <span class="tag-item">@tag</span>
                                }
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(item.Description))
                        {
                            <div class="entity-description">
                                @item.Description
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public List<TerminalCard> CreatureCards { get; set; } = new();
    [Parameter] public List<TerminalCard> ObjectCards { get; set; } = new();

    private RenderFragment GetIntentIcon(Intent? intent) => __builder =>
    {
        if (intent == null) return;

        var icon = intent switch
        {
            Intent.Unknown => "question",
            Intent.Attack => "explosion",
            Intent.Debuff => "droplet",
            Intent.Buff => "fire-flame-curved",
            _ => "question"
        };

        var color = intent switch
        {
            Intent.Unknown => "#FFD700",
            Intent.Attack => "#DC143C",
            Intent.Debuff => "#9370DB",
            Intent.Buff => "#4169E1",
            _ => "#FFD700"
        };

        var iconClass = $"fa-solid fa-{icon} intention-icon";
        var style = $"color: {color};";

        __builder.OpenElement(0, "span");
        __builder.AddAttribute(1, "class", "intention-icon");
        __builder.OpenElement(2, "i");
        __builder.AddAttribute(3, "class", iconClass);
        __builder.AddAttribute(4, "style", style);
        __builder.CloseElement();
        __builder.CloseElement();
    };
}
